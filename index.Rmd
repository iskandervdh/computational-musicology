---
title: "Computational Musicology Dashboard"
author: "Iskander van den Hombergh"
date: "2024-02-21"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
---

```{r setup, include=FALSE}
# Don't display the output of code blocks
knitr::opts_chunk$set(echo = FALSE)

# Setup required libraries
library(tidyverse)
library(spotifyr)
library(dplyr)
library(compmus)
```

### Corpus description

My corpus is a collection of multiple versions of the most common parts of a requiem mass, each by a different composer. While the texts of a requiem mass is (almost always) the same the music that composers have made based on these texts differs a lot. I was inspired to choose this as my corpus because I have sung the choir part of multiple requiem masses in the past and currently the choir I sing in is rehearsing the requiem by Mozart, which we will perform in april. Some other examples of composers that have written a requiem mass are Britten, Fauré and Duruflé, but many more versions by other composers are required to make any meaningful comparisons.

The things that are most interesting to look at are the difference in energy, valence and tempo of each requiem. This difference can be analyzed between the same part of the mass but from different composers or the difference between all the parts from the same mass by a single composer. Certain parts of requiem masses are very well known like the Dies Irae by Mozart. Which version by another composer has the most in common with a well known version of the same part and do they even sound somewhat similar at all? Is there a difference in how the texts of requiem have been put to music throughout time? These are things to look at with this collection of music.

A limitation of this corpus could be that the different versions by different composers have quite similar characteristics and can not produce any meaningful insight.

### Image Week 7

```{r}
mozart_requiem_audio_features <-
  spotifyr::get_playlist_audio_features("", "50MRaj6fdGWFu4rDxHvx4C")

mozart_requiem_audio_features |>
  ggplot(aes(x = valence, y = energy)) +
  theme(legend.position = "none") + geom_point() +
  geom_smooth() +
  ggtitle("Comparison between energy and valence in Mozart's Requiem") +
  # Center the title of the plot
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Valence", y = "Energy")
```

***

This image shows there is some correlation between the energy level and valence of different parts of the requiem by Mozart. This could be because the more serious or sadder parts of the requiem are slower on average and thus Spotify classifies them as less energetic. Another cause could be that Spotify can't really distinguish the difference between serious and a higher tempo and thus classifies parts with a higher tempo as having a higher valence and energy.


### Chromagram of the introitus of the Requiem by Mozart

```{r}
requiem_introitus_analysis <-
  get_tidy_audio_analysis("3V4FF9d8nBWfFR3fJ8uXEp") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

requiem_introitus_analysis |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  theme(aspect.ratio = 0.45) +
  scale_fill_viridis_c() +
  ggtitle("A chromagram of the introitus of Mozart's Requiem") +
  # Center the title of the plot
  theme(plot.title = element_text(hjust = 0.5))
```

***

This is a chromagram that shows the magnitude of each note during the introitus of the requiem by Mozart. The first few seconds of this recording consist of only silence, which explains why there is no pitch class with a magnitude other than 0.5 in the first few seconds. You can mostly see the pitch scales that have higher magnitudes mostly correspond to the key the piece is in, which is D minor. There is also the C# pitch scale that has a higher magnitude in the beginning. This can be explained by the fact that this note appears as in the sheet music using accidentals.